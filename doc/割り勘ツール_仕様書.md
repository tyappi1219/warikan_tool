# 割り勘ツール 仕様書

**バージョン**: 1.0  
**作成日**: 2026年1月29日  
**ファイル構成**: index.html, style.css, core.js

---

## 1. 概要

### 1.1 目的
飲み会・ランチ・出張精算・共同購入などにおける「支払いの不公平感」と「計算の手間」を解消し、最小のやり取りで公平に精算できるWebツール。

### 1.2 特徴
- **サーバ不要**: 完全クライアントサイド動作（ブラウザのみで完結）
- **インストール不要**: HTMLファイルをブラウザで開くだけで使用可能
- **依存ライブラリなし**: Vanilla JavaScript のみで実装
- **プライバシー重視**: データは端末内のlocalStorageに保存、外部送信なし

---

## 2. システム構成

### 2.1 ファイル構成
```
├── index.html    # 画面構造（HTML）
├── style.css     # スタイル定義（CSS）
├── core.js       # アプリケーションロジック（JavaScript）
└── 割り勘ツール_仕様書.md  # 本ドキュメント
```

### 2.2 対応ブラウザ
- Google Chrome（最新版）
- Microsoft Edge（最新版）
- Mozilla Firefox（最新版）
- Safari（最新版）
- iOS/Android 標準ブラウザ

---

## 3. 機能仕様

### 3.1 パーティ管理

| 機能 | 説明 |
|------|------|
| 新規作成 | 新しいパーティ（精算単位）を作成 |
| 複製 | 既存パーティをコピーして新規作成 |
| 削除 | パーティを削除（確認ダイアログあり） |
| 名称編集 | パーティ名を自由に変更 |
| 開催日設定 | 日付を設定 |

### 3.2 参加者管理

| 機能 | 説明 |
|------|------|
| 追加 | 名前、カラー、メモを設定して追加 |
| 編集 | 既存参加者の情報を変更 |
| 削除 | 参加者を削除（関連アイテムも自動調整） |
| カラータグ | 識別用の色を設定（8色からランダム初期値） |

### 3.3 アイテム（費用）管理

| 項目 | 説明 | 入力例 |
|------|------|--------|
| 品名 | 費用の名称 | ビール、タクシー代 |
| 金額 | 単価（税抜） | 700 |
| 数量 | 個数 | 3 |
| 税率 | 0%/8%/10%から選択 | 10% |
| 支払者 | 立て替えた人 | 佐藤 |
| 按分モード | 等分/個別選択 | 等分 |
| 対象者 | 個別選択時の負担者 | 佐藤、田中 |

### 3.4 按分モード

| モード | 説明 |
|--------|------|
| 等分 | 全参加者で均等に分割 |
| 個別選択 | 選択した参加者のみで分割 |

### 3.5 金額計算

#### 計算ロジック
1. **税込計算**: `金額 × 数量 × (1 + 税率/100)`
2. **按分計算**: 対象者で均等分割
3. **端数処理**: 最大剰余方式（Largest Remainder）で公平配分

#### 端数設定
| 設定項目 | 選択肢 |
|----------|--------|
| 端数単位 | 1円 / 5円 / 10円 / 100円 |
| 丸めモード | 四捨五入 / 切り上げ / 切り捨て |

### 3.6 最小決済（送金指示）

- **アルゴリズム**: 貪欲マッチング（Greedy Matching）
- **目的**: 送金回数を最小化
- **処理**: 
  1. 各参加者の「立替額 - 負担額」を計算
  2. プラス（受取）とマイナス（支払）に分類
  3. 金額の大きい順にマッチングして送金指示を生成

### 3.7 共有機能

| 機能 | 説明 |
|------|------|
| テキストコピー | 精算結果をテキスト形式でコピー |
| QRコード | 共有URL用のQR表示（プレースホルダー） |
| JSONエクスポート | パーティデータをJSONファイルでダウンロード |
| URL共有 | Base64エンコードしたURLをコピー |

### 3.8 データ保存

| 項目 | 説明 |
|------|------|
| 自動保存 | 変更時に自動でlocalStorageに保存 |
| JSONインポート | ドラッグ&ドロップまたはファイル選択 |
| JSONエクスポート | `splitbill_YYYY-MM-DD.json` 形式 |

### 3.9 多言語対応

| 言語 | 切替方法 |
|------|----------|
| 日本語（既定） | 🌐ボタンで切替 |
| 英語 | 🌐ボタンで切替 |

### 3.10 テーマ

| テーマ | 説明 |
|--------|------|
| 自動（既定） | OSの設定に従う |
| ライト | 明るい配色 |
| ダーク | 暗い配色 |

---

## 4. 画面仕様

### 4.1 画面一覧

| 画面 | 説明 |
|------|------|
| ホーム | パーティ一覧、新規作成、複製、削除 |
| 編集 | 参加者・アイテム管理、サマリ表示 |
| 結果 | 個人別内訳、送金指示、共有 |

### 4.2 モーダル一覧

| モーダル | 説明 |
|----------|------|
| 設定 | 端数単位、丸めモード、デフォルト税率 |
| 参加者追加/編集 | 名前、カラー、メモ |
| アイテム追加/編集 | 品名、金額、数量、税率、支払者、按分 |
| インポート | JSONファイルのドラッグ&ドロップ |

### 4.3 キーボードショートカット

| キー | 機能 | 画面 |
|------|------|------|
| N | 参加者追加 | 編集画面 |
| I | アイテム追加 | 編集画面 |
| Ctrl+S / Cmd+S | JSONエクスポート | 編集画面 |
| Escape | モーダルを閉じる | 全画面 |

---

## 5. データ仕様

### 5.1 JSONスキーマ

```json
{
  "version": "1.0",
  "party": {
    "id": "uuid",
    "name": "新年会",
    "date": "2026-01-29",
    "currency": "JPY",
    "settings": {
      "roundUnit": 1,
      "roundMode": "nearest",
      "taxDefault": 10
    }
  },
  "participants": [
    {
      "id": "uuid",
      "name": "佐藤",
      "color": "#F59E0B",
      "note": ""
    }
  ],
  "items": [
    {
      "id": "uuid",
      "name": "ビール",
      "amountMinor": 700,
      "qty": 3,
      "tax": 10,
      "payerId": "participant-uuid",
      "mode": "equal",
      "selection": []
    }
  ]
}
```

### 5.2 localStorageキー

| キー | 内容 |
|------|------|
| `splitbill_data` | パーティ一覧データ |
| `splitbill_settings` | アプリ設定（言語、テーマ等） |

---

## 6. デザイン仕様

### 6.1 カラーパレット

| 変数名 | ライト | ダーク | 用途 |
|--------|--------|--------|------|
| --brand | #0050D8 | #0050D8 | メインカラー |
| --accent | #00C4A7 | #00C4A7 | アクセント |
| --bg | #F7F9FC | #1A1A2E | 背景 |
| --bg-card | #FFFFFF | #16213E | カード背景 |
| --text | #121212 | #F7F9FC | テキスト |
| --text-muted | #6B7280 | #9CA3AF | 補助テキスト |
| --border | #E5E7EB | #374151 | ボーダー |
| --danger | #E11D48 | #E11D48 | エラー・削除 |
| --success | #10B981 | #10B981 | 成功 |

### 6.2 スペーシング

| 変数 | 値 |
|------|-----|
| --sp-1 | 4px |
| --sp-2 | 8px |
| --sp-3 | 12px |
| --sp-4 | 16px |
| --sp-5 | 24px |
| --sp-6 | 32px |

### 6.3 レスポンシブブレークポイント

| ブレークポイント | 対応 |
|------------------|------|
| < 640px | モバイル（1カラム） |
| 640px - 900px | タブレット |
| > 900px | デスクトップ（2カラム） |

---

## 7. 動作確認手順

### 7.1 起動方法

#### 方法1: 直接開く
1. `index.html` をダブルクリック
2. ブラウザが起動してツールが表示される

#### 方法2: ローカルサーバー（推奨）
```bash
# Pythonがインストールされている場合
cd ツール作成フォルダ
python -m http.server 8080

# ブラウザで http://localhost:8080 を開く
```

### 7.2 基本操作テスト

#### テスト1: パーティ作成
1. 「+ 新規作成」ボタンをクリック
2. パーティ名を「テスト飲み会」に変更
3. 日付を設定
4. ✅ 編集画面に遷移すること

#### テスト2: 参加者追加
1. 参加者パネルの「+」ボタンをクリック
2. 名前「佐藤」、カラー選択
3. 「追加」ボタンをクリック
4. 同様に「田中」「鈴木」を追加
5. ✅ 3人が一覧に表示されること

#### テスト3: アイテム追加
1. アイテムパネルの「+」ボタンをクリック
2. 以下を入力:
   - 品名: ビール
   - 金額: 700
   - 数量: 3
   - 税率: 10%
   - 支払者: 佐藤
   - 按分: 等分
3. 「追加」ボタンをクリック
4. ✅ アイテムが表示され、合計が ¥2,310 になること

#### テスト4: 精算結果確認
1. 「精算結果を見る」ボタンをクリック
2. ✅ 各参加者の負担額が表示されること
3. ✅ 送金指示が表示されること（田中→佐藤、鈴木→佐藤）

#### テスト5: 個別選択テスト
1. 「編集に戻る」をクリック
2. 新しいアイテムを追加:
   - 品名: タクシー代
   - 金額: 2000
   - 税率: 0%
   - 支払者: 田中
   - 按分: 個別選択
   - 対象者: 田中、鈴木のみチェック
3. ✅ 佐藤には負担がかからないこと

### 7.3 端数処理テスト

#### テスト6: 等分の端数（最大剰余方式）
1. 新規パーティを作成
2. 参加者3人を追加
3. アイテム追加:
   - 金額: 10001
   - 数量: 1
   - 税率: 0%
4. ✅ 負担額が {3334, 3333, 3334} のように配分されること

#### テスト7: 100円丸めテスト
1. 設定（⚙️）を開く
2. 端数単位を「100円」に変更
3. 丸めモードを「四捨五入」に設定
4. 保存
5. アイテム追加:
   - 金額: 12345
   - 参加者5人
6. ✅ 各人が2400〜2500円になり、合計が12345円になること

### 7.4 共有機能テスト

#### テスト8: テキストコピー
1. 精算結果画面で「テキストコピー」をクリック
2. メモ帳等に貼り付け
3. ✅ パーティ名、合計、内訳、送金指示がテキストで出力されること

#### テスト9: JSONエクスポート/インポート
1. 「JSONエクスポート」をクリック
2. ✅ `splitbill_YYYY-MM-DD.json` がダウンロードされること
3. ホーム画面に戻る
4. フッターの「インポート」をクリック
5. ダウンロードしたJSONをドラッグ&ドロップ
6. ✅ パーティが復元されること

#### テスト10: URL共有
1. 精算結果画面で「URL共有」をクリック
2. ✅ 「URLをコピーしました」トーストが表示されること
3. 新しいブラウザタブでURLを開く
4. ✅ 同じパーティが表示されること

### 7.5 UI/UXテスト

#### テスト11: テーマ切替
1. 🌙ボタンを複数回クリック
2. ✅ 自動→ライト→ダーク→自動 と切り替わること

#### テスト12: 言語切替
1. 🌐ボタンをクリック
2. ✅ 日本語↔英語が切り替わること

#### テスト13: レスポンシブ確認
1. ブラウザの幅を狭める（640px以下）
2. ✅ 1カラムレイアウトに変更されること
3. ✅ サマリバーが縦並びになること

#### テスト14: データ永続化
1. パーティを作成・編集
2. ブラウザを閉じて再度開く
3. ✅ データが保持されていること

---

## 8. 制限事項・既知の問題

### 8.1 制限事項
- 通貨は日本円（JPY）のみ対応
- QRコード生成は簡易実装（URL共有を推奨）
- 比率指定モードは未実装（等分/個別選択のみ）
- オフライン動作は可能だが、PWA対応は未実装

### 8.2 注意事項
- localStorageはブラウザ・端末ごとに独立
- ブラウザのデータ削除でデータ喪失の可能性あり
- 定期的なJSONエクスポートを推奨
- 共有URLは長くなる場合がある（大規模データ時）

---

## 9. 今後の拡張候補

- [ ] PWA対応（オフライン・ホーム画面追加）
- [ ] 多通貨対応（USD, EUR等）
- [ ] 比率指定モード
- [ ] 固定額負担
- [ ] 割引/クーポン対応
- [ ] QRコード生成（実装）
- [ ] クラウド同期
- [ ] 決済サービス連携（PayPay, LINE Pay等）

---

## 10. 更新履歴

| 日付 | バージョン | 内容 |
|------|------------|------|
| 2026-01-29 | 1.0 | 初版作成 |
